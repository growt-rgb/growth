<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Growth Coaching | Admin Dashboard</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Excel Export Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <!-- EmailJS -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script type="text/javascript">
       (function(){
          emailjs.init("4D7tV8iGZl0O5B9Ej");
       })();
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=SolaimanLipi&display=swap');
        :root { --primary: #242650; --secondary: #F8B62D; --light: #f4f6f9; --dark: #1a1c3d; --success: #2ecc71; --danger: #e74c3c; --warning: #f1c40f; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'SolaimanLipi', sans-serif; }
        body { background: var(--light); color: #333; }
        #login-section { height: 100vh; display: flex; justify-content: center; align-items: center; background: linear-gradient(135deg, var(--primary), var(--dark)); }
        .login-box { background: white; padding: 40px; border-radius: 10px; width: 100%; max-width: 400px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.3); border-top: 5px solid var(--secondary); }
        .login-box img { height: 60px; margin-bottom: 20px; }
        .form-control { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 5px; }
        .btn-login { width: 100%; padding: 12px; background: var(--primary); color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; font-weight: bold; transition: 0.3s; }
        .btn-login:hover { background: var(--secondary); color: var(--primary); }
        #admin-panel { display: none; display: flex; height: 100vh; }
        .sidebar { width: 250px; background: var(--primary); color: white; display: flex; flex-direction: column; transition: 0.3s; }
        .sidebar-header { padding: 20px; text-align: center; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .sidebar-header h2 { color: var(--secondary); font-size: 20px; }
        .menu { list-style: none; padding: 20px 0; flex: 1; }
        .menu li a { display: flex; align-items: center; padding: 15px 25px; color: #bdc3c7; text-decoration: none; transition: 0.3s; }
        .menu li a:hover, .menu li a.active { background: rgba(255,255,255,0.1); color: var(--secondary); border-left: 4px solid var(--secondary); }
        .menu li a i { margin-right: 15px; width: 20px; }
        .logout-btn { padding: 15px; background: #c0392b; border: none; color: white; cursor: pointer; text-align: left; width: 100%; display: flex; align-items: center; }
        .logout-btn i { margin-right: 10px; margin-left: 20px;}
        .main-content { flex: 1; overflow-y: auto; padding: 20px; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .page-title { font-size: 24px; color: var(--primary); font-weight: bold; border-bottom: 3px solid var(--secondary); display: inline-block; padding-bottom: 5px;}
        .dashboard-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .card { background: white; padding: 25px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); display: flex; align-items: center; justify-content: space-between; border-left: 5px solid var(--primary); }
        .card-info h3 { font-size: 28px; color: var(--primary); margin-bottom: 5px; }
        .card-info p { color: #777; font-size: 14px; }
        .card-icon { font-size: 40px; color: rgba(36, 38, 80, 0.1); }
        .card.income { border-color: var(--success); }
        .card.pending { border-color: var(--warning); }
        .table-container { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; min-width: 800px; }
        th, td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #eee; }
        th { background: var(--light); color: var(--primary); font-weight: bold; }
        tr:hover { background: #f9f9f9; }
        .status { padding: 5px 10px; border-radius: 20px; font-size: 12px; font-weight: bold; }
        .status.Pending { background: #fff3cd; color: #856404; }
        .status.Approved { background: #d4edda; color: #155724; }
        .action-btn { border: none; padding: 6px 10px; border-radius: 4px; cursor: pointer; margin-right: 5px; color: white; transition: 0.3s; }
        .btn-approve { background: var(--success); }
        .btn-delete { background: var(--danger); }
        .btn-view { background: var(--primary); }
        .btn-edit { background: var(--warning); color: #333; }
        .settings-box { background: white; padding: 30px; border-radius: 10px; max-width: 600px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .settings-box label { font-weight: bold; display: block; margin-bottom: 8px; color: var(--primary); }
        .settings-box textarea, .settings-box input, .settings-box select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; margin-bottom: 20px; }
        .btn-save { background: var(--secondary); color: var(--primary); padding: 10px 25px; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; }
        .btn-print { background: #34495e; color: #fff; padding: 8px 15px; border: none; border-radius: 5px; cursor: pointer; margin-right: 10px; }
        .btn-excel { background: #27ae60; color: #fff; padding: 8px 15px; border: none; border-radius: 5px; cursor: pointer; }
        
        /* রেজাল্ট ম্যানেজমেন্ট স্টাইল */
        .subject-manager { margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; }
        .subject-list { display: flex; flex-wrap: wrap; gap: 10px; margin: 10px 0; }
        .subject-tag { background: #e3f2fd; padding: 5px 15px; border-radius: 20px; display: flex; align-items: center; gap: 8px; }
        .subject-tag button { background: #ff6b6b; color: white; border: none; border-radius: 50%; width: 20px; height: 20px; cursor: pointer; font-size: 12px; }
        .mark-input-group { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; }
        .grade-badge { display: inline-block; padding: 3px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; }
        .grade-Aplus { background: #2ecc71; color: white; }
        .grade-A { background: #3498db; color: white; }
        .grade-B { background: #f39c12; color: white; }
        .grade-C { background: #e74c3c; color: white; }
        .grade-D { background: #9b59b6; color: white; }
        .grade-F { background: #7f8c8d; color: white; }
        
        @media (max-width: 768px) {
            #admin-panel { flex-direction: column; }
            .sidebar { width: 100%; height: auto; }
            .menu { display: flex; overflow-x: auto; padding: 10px; }
            .menu li a { padding: 10px; font-size: 14px; flex-direction: column; text-align: center; }
            .menu li a i { margin: 0 0 5px 0; }
            .logout-btn { width: auto; position: absolute; top: 10px; right: 10px; background: transparent; padding: 5px; }
        }
        @media print {
            .sidebar, .header, .btn-print, .btn-excel, .action-btn { display: none !important; }
            .main-content { margin: 0; padding: 0; }
            table { min-width: 100%; }
        }
        .view-section { display: none; animation: fadeIn 0.3s; }
        .view-section.active { display: block; }
        @keyframes fadeIn { from {opacity:0;} to {opacity:1;} }
        #loader { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.8); z-index: 9999; justify-content: center; align-items: center; flex-direction: column; }
        .spinner { border: 5px solid #f3f3f3; border-top: 5px solid var(--secondary); border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div id="loader"><div class="spinner"></div><p style="margin-top:10px; color: var(--primary);">লোড হচ্ছে...</p></div>

    <section id="login-section">
        <div class="login-box">
            <img src="https://i.postimg.cc/T3JzNMm3/20251212-135421.png" alt="Logo">
            <h2 style="color: var(--primary); margin-bottom: 5px;">এডমিন প্যানেল</h2>
            <p style="margin-bottom: 20px; color: #666;">প্রবেশ করতে লগইন করুন</p>
            <form id="adminLoginForm">
                <input type="email" id="adminEmail" class="form-control" placeholder="এডমিন ইমেইল" required>
                <input type="password" id="adminPass" class="form-control" placeholder="পাসওয়ার্ড" required>
                <button type="submit" class="btn-login">লগইন</button>
            </form>
        </div>
    </section>

    <section id="admin-panel" style="display: none;">
        <div class="sidebar">
            <div class="sidebar-header"><h2>গ্রোথ কোচিং সেন্টার</h2><small>অ্যাডমিনিস্ট্রেটর</small></div>
            <ul class="menu">
                <li><a href="#" onclick="switchView('dashboard')" class="active"><i class="fas fa-th-large"></i> ড্যাশবোর্ড</a></li>
                <li><a href="#" onclick="switchView('students')"><i class="fas fa-user-graduate"></i> সকল শিক্ষার্থী</a></li>
                <li><a href="#" onclick="switchView('payments')"><i class="fas fa-money-check-alt"></i> পেমেন্ট রিকোয়েস্ট</a></li>
                <li><a href="#" onclick="switchView('courses')"><i class="fas fa-book"></i> কোর্স ম্যানেজমেন্ট</a></li>
                <li><a href="#" onclick="switchView('reports')"><i class="fas fa-file-excel"></i> স্টুডেন্ট রিপোর্ট</a></li>
                <li><a href="#" onclick="switchView('results')"><i class="fas fa-chart-bar"></i> রেজাল্ট ম্যানেজমেন্ট</a></li>
                <li><a href="#" onclick="switchView('settings')"><i class="fas fa-cogs"></i> অ্যাপ কন্ট্রোল</a></li>
            </ul>
            <button onclick="logoutAdmin()" class="logout-btn"><i class="fas fa-sign-out-alt"></i> লগআউট</button>
        </div>

        <div class="main-content">
            <div id="dashboard" class="view-section active">
                <div class="header"><h2 class="page-title">ওভারভিউ</h2><span>আজকের তারিখ: <strong id="currentDate">--</strong></span></div>
                <div class="dashboard-cards">
                    <div class="card"><div class="card-info"><h3 id="totalStudents">0</h3><p>মোট শিক্ষার্থী</p></div><i class="fas fa-users card-icon"></i></div>
                    <div class="card income"><div class="card-info"><h3 id="totalIncome">0 ৳</h3><p>সর্বমোট আয়</p></div><i class="fas fa-coins card-icon" style="color: var(--success);"></i></div>
                    <div class="card pending"><div class="card-info"><h3 id="pendingRequests">0</h3><p>অপেক্ষমান ভর্তি</p></div><i class="fas fa-clock card-icon" style="color: var(--warning);"></i></div>
                </div>
                <div class="table-container">
                    <h3 style="margin-bottom: 15px; color: var(--primary);">সর্বশেষ ভর্তি</h3>
                    <table>
                        <thead><tr><th>আইডি</th><th>নাম</th><th>কোর্স</th><th>ফি</th><th>স্ট্যাটাস</th></tr></thead>
                        <tbody id="recentAdmissionTable"></tbody>
                    </table>
                </div>
            </div>

            <div id="students" class="view-section">
                <div class="header"><h2 class="page-title">সকল শিক্ষার্থী</h2><input type="text" id="searchInput" placeholder="নাম বা আইডি দিয়ে খুঁজুন..." onkeyup="filterStudents()" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;"></div>
                <div class="table-container">
                    <table>
                        <thead><tr><th>ছবি/আইডি</th><th>নাম & মোবাইল</th><th>কোর্স</th><th>পেমেন্ট মাধ্যম</th><th>অবস্থা</th><th>অ্যাকশন</th></tr></thead>
                        <tbody id="allStudentsTable"></tbody>
                    </table>
                </div>
            </div>

            <div id="payments" class="view-section">
                <div class="header"><h2 class="page-title">পেমেন্ট ভেরিফিকেশন</h2></div>
                <div class="table-container">
                    <p style="margin-bottom: 15px; color: #666;">অনলাইন পেমেন্ট এবং ট্রানজেকশন আইডি চেক করে অ্যাপ্রুভ করুন।</p>
                    <table>
                        <thead><tr><th>স্টুডেন্ট আইডি</th><th>পেমেন্ট মাধ্যম</th><th>TrxID</th><th>টাকার পরিমাণ</th><th>তারিখ</th><th>অ্যাকশন</th></tr></thead>
                        <tbody id="paymentTable"></tbody>
                    </table>
                </div>
            </div>

            <div id="courses" class="view-section">
                <div class="header"><h2 class="page-title">কোর্স ম্যানেজমেন্ট</h2></div>
                <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                    <div class="settings-box" style="flex: 1;">
                        <h3 style="margin-bottom: 20px;">নতুন কোর্স যোগ / এডিট করুন</h3>
                        <input type="hidden" id="editCourseId">
                        <label>কোর্সের নাম</label><input type="text" id="courseTitle" placeholder="যেমন: SSC স্পেশাল">
                        <label>ফি (টাকা)</label><input type="number" id="coursePrice" placeholder="যেমন: ৫০০০">
                        <label>ছোট বিবরণ (কার্ডে দেখাবে)</label><input type="text" id="courseShort" placeholder="যেমন: স্পেশাল প্রস্তুতি">
                        <label>বিস্তারিত বিবরণ</label><textarea id="courseDesc" rows="3" placeholder="কোর্স সম্পর্কে বিস্তারিত..."></textarea>
                        <label>ফিচার (কমা দিয়ে লিখুন)</label><input type="text" id="courseFeatures" placeholder="যেমন: লাইভ ক্লাস, শীট, এক্সাম">
                        <label>আইকন সিলেক্ট করুন</label>
                        <select id="courseIcon">
                            <option value="fas fa-graduation-cap">গ্র্যাজুয়েশন ক্যাপ</option>
                            <option value="fas fa-book">বই</option>
                            <option value="fas fa-medal">মেডেল</option>
                            <option value="fas fa-star">স্টার</option>
                            <option value="fas fa-laptop-house">ল্যাপটপ (অনলাইন)</option>
                        </select>
                        <button onclick="saveCourse()" class="btn-save">সেভ করুন</button>
                        <button onclick="resetCourseForm()" style="margin-left: 10px; background: #999;" class="btn-save">রিসেট</button>
                    </div>
                    <div class="table-container" style="flex: 1;">
                        <h3>বর্তমান কোর্সসমূহ</h3>
                        <table>
                            <thead><tr><th>নাম</th><th>ফি</th><th>অ্যাকশন</th></tr></thead>
                            <tbody id="coursesListTable"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="reports" class="view-section">
                <div class="header">
                    <h2 class="page-title">বিস্তারিত স্টুডেন্ট রিপোর্ট</h2>
                    <div>
                        <button onclick="printReport()" class="btn-print"><i class="fas fa-print"></i> প্রিন্ট</button>
                        <button onclick="downloadExcel()" class="btn-excel"><i class="fas fa-file-excel"></i> এক্সেল ডাউনলোড</button>
                    </div>
                </div>
                <div class="table-container" id="printableArea">
                    <div style="text-align: center; display: none;" id="printHeader">
                        <h1>গ্রোথ কোচিং সেন্টার</h1>
                        <p>সকল শিক্ষার্থীর তালিকা</p>
                        <hr><br>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>আইডি</th>
                                <th>নাম</th>
                                <th>মোবাইল</th>
                                <th>অভিভাবক</th>
                                <th>ঠিকানা</th>
                                <th>কোর্স</th>
                                <th>ফি</th>
                                <th>জমা</th>
                                <th>তারিখ</th>
                            </tr>
                        </thead>
                        <tbody id="reportTableBody"></tbody>
                    </table>
                </div>
            </div>

            <div id="results" class="view-section">
                <div class="header"><h2 class="page-title">রেজাল্ট ম্যানেজমেন্ট</h2></div>
                <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                    <div class="settings-box" style="flex: 1;">
                        <h3 style="margin-bottom: 20px;">ডাইনামিক সাবজেক্ট ম্যানেজমেন্ট</h3>
                        
                        <!-- সাবজেক্ট এড ফর্ম -->
                        <div class="subject-manager">
                            <h4 style="margin-bottom: 10px; color: var(--primary);">সাবজেক্ট যোগ/পরিবর্তন করুন</h4>
                            <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                                <input type="text" id="newSubject" placeholder="নতুন সাবজেক্টের নাম" style="flex: 1;">
                                <button onclick="addSubject()" class="btn-save" style="padding: 8px 15px;">সাবজেক্ট যোগ</button>
                            </div>
                            <div class="subject-list" id="subjectList">
                                <!-- সাবজেক্ট ট্যাগগুলো এখানে লোড হবে -->
                            </div>
                        </div>

                        <h4 style="margin-bottom: 10px; color: var(--primary);">স্টুডেন্ট রেজাল্ট আপলোড/আপডেট করুন</h4>
                        <input type="hidden" id="editStudentId">
                        <label>স্টুডেন্ট সিলেক্ট করুন</label>
                        <select id="studentSelect" onchange="loadStudentResults()">
                            <option value="">নির্বাচন করুন</option>
                        </select>
                        
                        <div id="subjectInputs">
                            <!-- ডাইনামিক সাবজেক্ট ইনপুট ফিল্ড এখানে লোড হবে -->
                        </div>
                        
                        <!-- গ্রেড স্ট্যাটাস (অটোমেটিকভাবে সেট হবে, শুধু দেখানোর জন্য) -->
                        <label>গ্রেড স্ট্যাটাস (অটোমেটিক ক্যালকুলেটেড)</label>
                        <div id="autoGradeStatus" style="padding: 10px; background: #f0f8ff; border-radius: 5px; margin-bottom: 15px; font-weight: bold;">
                            গ্রেড: <span id="autoGrade">-</span> | GPA: <span id="autoGPA">-</span> | স্ট্যাটাস: <span id="autoStatus">-</span>
                        </div>
                        
                        <label>মন্তব্য/ফিডব্যাক (স্টুডেন্টদের রেজাল্টে দেখাবে)</label>
                        <textarea id="resultComment" rows="3" placeholder="স্টুডেন্টের পারফর্মেন্স সম্পর্কে মন্তব্য..."></textarea>
                        
                        <button onclick="saveResults()" class="btn-save">রেজাল্ট সেভ করুন</button>
                        <button onclick="resetResultForm()" style="margin-left: 10px; background: #999;" class="btn-save">রিসেট</button>
                    </div>
                    
                    <div class="table-container" style="flex: 1;">
                        <h3>সকল স্টুডেন্টের রেজাল্ট স্ট্যাটাস</h3>
                        <div style="margin-bottom: 15px;">
                            <input type="text" id="searchResult" placeholder="স্টুডেন্ট সার্চ..." onkeyup="filterResults()" style="padding: 8px; width: 100%; border: 1px solid #ddd; border-radius: 5px;">
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>আইডি</th>
                                    <th>নাম</th>
                                    <th>গ্রেড</th>
                                    <th>GPA</th>
                                    <th>স্ট্যাটাস</th>
                                    <th>অ্যাকশন</th>
                                </tr>
                            </thead>
                            <tbody id="resultsListTable"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="settings" class="view-section">
                <div class="header"><h2 class="page-title">অ্যাপ কন্ট্রোল ও কন্টেন্ট</h2></div>
                <div class="settings-box">
                    <h3 style="margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 10px;">নোটিশ এবং অফার আপডেট</h3>
                    <label>হেডলাইন নোটিশ (Marquee Text)</label><input type="text" id="siteNotice" placeholder="যেমন: আগামী ২০ তারিখ ক্লাস বন্ধ...">
                    <label>অফার বা ডিসকাউন্ট টেক্সট</label><input type="text" id="siteOffer" placeholder="যেমন: ১৫০০ টাকা ছাড়!">
                    <button onclick="saveSiteSettings()" class="btn-save">আপডেট করুন</button>
                    <p style="margin-top: 10px; font-size: 12px; color: #666;">* এই পরিবর্তনগুলো ইউজার অ্যাপে দেখতে হলে ইউজার অ্যাপ আপডেট করতে হবে।</p>
                </div>
            </div>
        </div>
    </section>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, getDocs, doc, updateDoc, deleteDoc, setDoc, addDoc, getDoc, query, where } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDTpAqEbM81jj5q7Lp9tupXS2Jnsq3B_Ng",
            authDomain: "growth-coaching-centre.firebaseapp.com",
            projectId: "growth-coaching-centre",
            storageBucket: "growth-coaching-centre.firebasestorage.app",
            messagingSenderId: "493057354872",
            appId: "1:493057354872:web:38523a06795f0f0200518d",
            measurementId: "G-RT5X82FM5F"
        };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let studentsData = [];
        let coursesData = [];
        let subjectsList = []; // গ্লোবাল সাবজেক্ট লিস্ট

        // বাংলাদেশের গ্রেডিং সিস্টেম অনুযায়ী আপডেটেড ফাংশন
        function calculateGrade(marks) {
            if (marks >= 80) return { grade: "A+", status: "অত্যুত্তম", gpa: 5.00, class: "grade-Aplus" };
            if (marks >= 70) return { grade: "A", status: "খুব ভালো", gpa: 4.00, class: "grade-A" };
            if (marks >= 60) return { grade: "A-", status: "ভালো", gpa: 3.50, class: "grade-A" };
            if (marks >= 50) return { grade: "B", status: "মোটামুটি", gpa: 3.00, class: "grade-B" };
            if (marks >= 40) return { grade: "C", status: "পাশ", gpa: 2.00, class: "grade-C" };
            if (marks >= 33) return { grade: "D", status: "পাশ", gpa: 1.00, class: "grade-D" };
            return { grade: "F", status: "ফেল", gpa: 0.00, class: "grade-F" };
        }

        // সাবজেক্টের জন্য গ্রেড ক্যালকুলেশন
        function getSubjectGrade(marks) {
            if (marks >= 80) return { grade: "A+", gpa: 5.00, class: "grade-Aplus" };
            if (marks >= 70) return { grade: "A", gpa: 4.00, class: "grade-A" };
            if (marks >= 60) return { grade: "A-", gpa: 3.50, class: "grade-A" };
            if (marks >= 50) return { grade: "B", gpa: 3.00, class: "grade-B" };
            if (marks >= 40) return { grade: "C", gpa: 2.00, class: "grade-C" };
            if (marks >= 33) return { grade: "D", gpa: 1.00, class: "grade-D" };
            return { grade: "F", gpa: 0.00, class: "grade-F" };
        }

        const loginForm = document.getElementById('adminLoginForm');
        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('adminEmail').value;
            const pass = document.getElementById('adminPass').value;
            showLoader();
            signInWithEmailAndPassword(auth, email, pass)
                .then((userCredential) => {
                    hideLoader();
                })
                .catch((error) => {
                    hideLoader();
                    alert("লগইন ব্যর্থ হয়েছে: " + error.message);
                });
        });

        onAuthStateChanged(auth, (user) => {
            if (user) {
                document.getElementById('login-section').style.display = 'none';
                document.getElementById('admin-panel').style.display = 'flex';
                document.getElementById('currentDate').innerText = new Date().toLocaleDateString('bn-BD');
                loadDashboardData();
            } else {
                document.getElementById('login-section').style.display = 'flex';
                document.getElementById('admin-panel').style.display = 'none';
            }
        });

        window.logoutAdmin = () => { signOut(auth).then(() => window.location.reload()); };

        async function loadDashboardData() {
            showLoader();
            try {
                const q = query(collection(db, "students"));
                const querySnapshot = await getDocs(q);
                studentsData = [];
                let totalIncome = 0;
                let pendingCount = 0;
                querySnapshot.forEach((doc) => {
                    let data = doc.data();
                    data.docId = doc.id; 
                    studentsData.push(data);
                    if (data.status === 'Approved') totalIncome += parseInt(data.courseFee) || 0;
                    if (data.status === 'Pending') pendingCount++;
                });
                document.getElementById('totalStudents').innerText = studentsData.length;
                document.getElementById('totalIncome').innerText = totalIncome + ' ৳';
                document.getElementById('pendingRequests').innerText = pendingCount;
                renderTables();
                loadCourses();
                loadSettings();
                loadResultsManagement();
                loadSubjects(); // সাবজেক্ট লোড করুন
            } catch (error) { console.error(error); alert("ডাটা লোড করতে সমস্যা হয়েছে।"); } finally { hideLoader(); }
        }

        function renderTables() {
            const recentTable = document.getElementById('recentAdmissionTable');
            const allTable = document.getElementById('allStudentsTable');
            const payTable = document.getElementById('paymentTable');
            const reportTable = document.getElementById('reportTableBody');

            recentTable.innerHTML = ''; allTable.innerHTML = ''; payTable.innerHTML = ''; reportTable.innerHTML = '';
            
            studentsData.sort((a, b) => new Date(b.admittedAt) - new Date(a.admittedAt));
            
            studentsData.forEach((student, index) => {
                const statusClass = student.status === 'Approved' ? 'Approved' : 'Pending';
                
                // Dashboard Recent
                if(index < 5) {
                    recentTable.innerHTML += `<tr><td>${student.studentId}</td><td>${student.studentName}</td><td>${student.courseName}</td><td>${student.courseFee}</td><td><span class="status ${statusClass}">${student.status}</span></td></tr>`;
                }

                // All Students
                allTable.innerHTML += `<tr><td><b>${student.studentId}</b></td><td>${student.studentName}<br><small>${student.studentMobile}</small></td><td>${student.courseName}</td><td>${student.paymentMethod}</td><td><span class="status ${statusClass}">${student.status}</span></td><td>${student.status === 'Pending' ? `<button class="action-btn btn-approve" onclick="updateStudentStatus('${student.docId}', 'Approved')"><i class="fas fa-check"></i></button>` : ''}<button class="action-btn btn-delete" onclick="deleteStudent('${student.docId}')"><i class="fas fa-trash"></i></button><button class="action-btn btn-view" onclick="alert('অভিভাবক: ${student.guardianName}\\nঠিকানা: ${student.address}')"><i class="fas fa-eye"></i></button></td></tr>`;
                
                // Payments
                if(student.status === 'Pending') {
                    payTable.innerHTML += `<tr><td>${student.studentId}</td><td>${student.paymentMethod}</td><td style="color:blue; font-weight:bold;">${student.trxId || 'N/A'}</td><td>${student.courseFee}</td><td>${new Date(student.admittedAt).toLocaleDateString()}</td><td><button class="action-btn btn-approve" onclick="updateStudentStatus('${student.docId}', 'Approved')">Approve</button><button class="action-btn btn-delete" onclick="deleteStudent('${student.docId}')">Reject</button></td></tr>`;
                }

                // Report Table
                reportTable.innerHTML += `
                    <tr>
                        <td>${student.studentId}</td>
                        <td>${student.studentName}</td>
                        <td>${student.studentMobile}</td>
                        <td>${student.guardianName}</td>
                        <td>${student.address}</td>
                        <td>${student.courseName}</td>
                        <td>${student.courseFee}</td>
                        <td>${student.status === 'Approved' ? student.courseFee : '0'}</td>
                        <td>${new Date(student.admittedAt).toLocaleDateString()}</td>
                    </tr>
                `;
            });
        }

        // --- সাবজেক্ট ম্যানেজমেন্ট ফাংশন ---
        async function loadSubjects() {
            try {
                const docRef = doc(db, "settings", "subjects");
                const docSnap = await getDoc(docRef);
                if (docSnap.exists()) {
                    subjectsList = docSnap.data().list || [];
                } else {
                    // ডিফল্ট সাবজেক্ট
                    subjectsList = ['বাংলা', 'ইংরেজি', 'গণিত', 'বিজ্ঞান', 'সামাজিক বিজ্ঞান', 'ধর্ম'];
                    // ডিফল্ট সাবজেক্টস ডাটাবেজে সেভ করুন
                    await setDoc(doc(db, "settings", "subjects"), { 
                        list: subjectsList, 
                        updatedAt: new Date() 
                    });
                }
                updateSubjectListUI();
            } catch (error) {
                console.error("সাবজেক্ট লোড করতে সমস্যা:", error);
                subjectsList = ['বাংলা', 'ইংরেজি', 'গণিত', 'বিজ্ঞান', 'সামাজিক বিজ্ঞান', 'ধর্ম'];
                updateSubjectListUI();
            }
        }

        function updateSubjectListUI() {
            const subjectListDiv = document.getElementById('subjectList');
            subjectListDiv.innerHTML = '';
            subjectsList.forEach((subject, index) => {
                subjectListDiv.innerHTML += `
                    <div class="subject-tag">
                        ${subject}
                        <button onclick="removeSubject(${index})">×</button>
                    </div>
                `;
            });
            
            // সাবজেক্ট ইনপুট ফিল্ডগুলো আপডেট করুন
            updateSubjectInputs();
        }

        window.addSubject = async () => {
            const newSubjectInput = document.getElementById('newSubject');
            const newSubject = newSubjectInput.value.trim();
            if (!newSubject) {
                alert("সাবজেক্টের নাম দিন");
                return;
            }
            if (subjectsList.includes(newSubject)) {
                alert("এই সাবজেক্ট ইতিমধ্যে আছে");
                return;
            }
            
            subjectsList.push(newSubject);
            newSubjectInput.value = '';
            
            try {
                await setDoc(doc(db, "settings", "subjects"), { list: subjectsList, updatedAt: new Date() });
                updateSubjectListUI();
                alert("সাবজেক্ট যোগ করা হয়েছে!");
            } catch (error) {
                alert("সাবজেক্ট সেভ করতে সমস্যা: " + error.message);
            }
        }

        window.removeSubject = async (index) => {
            if (!confirm("এই সাবজেক্টটি রিমুভ করবেন?")) return;
            
            subjectsList.splice(index, 1);
            try {
                await setDoc(doc(db, "settings", "subjects"), { list: subjectsList, updatedAt: new Date() });
                updateSubjectListUI();
                alert("সাবজেক্ট রিমুভ করা হয়েছে!");
            } catch (error) {
                alert("সাবজেক্ট আপডেট করতে সমস্যা: " + error.message);
            }
        }
        // ------------------------------------

        // --- কোর্স ম্যানেজমেন্ট ফাংশন ---
        async function loadCourses() {
            const listTable = document.getElementById('coursesListTable');
            listTable.innerHTML = 'Loading...';
            try {
                const snp = await getDocs(collection(db, "courses"));
                coursesData = [];
                listTable.innerHTML = '';
                snp.forEach(d => {
                    const c = d.data();
                    c.id = d.id;
                    coursesData.push(c);
                    listTable.innerHTML += `
                        <tr>
                            <td>${c.title}</td>
                            <td>${c.price}</td>
                            <td>
                                <button class="action-btn btn-edit" onclick="editCourse('${c.id}')"><i class="fas fa-edit"></i></button>
                                <button class="action-btn btn-delete" onclick="deleteCourse('${c.id}')"><i class="fas fa-trash"></i></button>
                            </td>
                        </tr>
                    `;
                });
            } catch(e) { console.log(e); }
        }

        window.saveCourse = async () => {
            const id = document.getElementById('editCourseId').value;
            const title = document.getElementById('courseTitle').value;
            const price = document.getElementById('coursePrice').value;
            const shortDesc = document.getElementById('courseShort').value;
            const description = document.getElementById('courseDesc').value;
            const features = document.getElementById('courseFeatures').value.split(',').map(s=>s.trim()).filter(s=>s);
            const icon = document.getElementById('courseIcon').value;

            if(!title || !price) return alert("নাম এবং ফি দিতে হবে");

            const data = { title, price, shortDesc, description, features, icon };
            showLoader();
            try {
                if(id) {
                    await updateDoc(doc(db, "courses", id), data);
                    alert("কোর্স আপডেট হয়েছে!");
                } else {
                    await addDoc(collection(db, "courses"), data);
                    alert("নতুন কোর্স যোগ হয়েছে!");
                }
                resetCourseForm();
                loadCourses();
            } catch(e) { alert(e.message); } finally { hideLoader(); }
        }

        window.editCourse = (id) => {
            const c = coursesData.find(x => x.id === id);
            if(!c) return;
            document.getElementById('editCourseId').value = c.id;
            document.getElementById('courseTitle').value = c.title;
            document.getElementById('coursePrice').value = c.price;
            document.getElementById('courseShort').value = c.shortDesc || "";
            document.getElementById('courseDesc').value = c.description || "";
            document.getElementById('courseFeatures').value = c.features ? c.features.join(', ') : "";
            document.getElementById('courseIcon').value = c.icon || "fas fa-graduation-cap";
        }

        window.deleteCourse = async (id) => {
            if(!confirm("কোর্সটি ডিলিট করবেন?")) return;
            showLoader();
            try { await deleteDoc(doc(db, "courses", id)); loadCourses(); } catch(e){ alert(e.message); } finally { hideLoader(); }
        }

        window.resetCourseForm = () => {
            document.getElementById('editCourseId').value = "";
            document.getElementById('courseTitle').value = "";
            document.getElementById('coursePrice').value = "";
            document.getElementById('courseShort').value = "";
            document.getElementById('courseDesc').value = "";
            document.getElementById('courseFeatures').value = "";
        }
        // ------------------------------------

        // --- রেজাল্ট ম্যানেজমেন্ট ফাংশন ---
        function updateSubjectInputs() {
            const subjectInputsDiv = document.getElementById('subjectInputs');
            subjectInputsDiv.innerHTML = '';
            
            subjectsList.forEach(subject => {
                subjectInputsDiv.innerHTML += `
                    <div class="mark-input-group">
                        <input type="number" id="mark_${subject}" placeholder="${subject} মার্ক (0-100)" min="0" max="100" style="padding: 10px;" 
                               oninput="calculateSubjectGrade('${subject}'); calculateOverallGrade()">
                        <span id="grade_${subject}" style="padding: 10px; text-align: center; font-weight: bold;">-</span>
                    </div>
                `;
            });
        }

        window.calculateSubjectGrade = (subject) => {
            const input = document.getElementById(`mark_${subject}`);
            const gradeSpan = document.getElementById(`grade_${subject}`);
            if (input && gradeSpan) {
                const mark = parseInt(input.value) || 0;
                const gradeInfo = getSubjectGrade(mark);
                gradeSpan.innerHTML = `<span class="grade-badge ${gradeInfo.class}">${gradeInfo.grade} (${gradeInfo.gpa})</span>`;
            }
        }

        window.calculateOverallGrade = () => {
            let totalMarks = 0;
            let count = 0;
            
            subjectsList.forEach(subject => {
                const input = document.getElementById(`mark_${subject}`);
                if (input) {
                    const mark = parseInt(input.value) || 0;
                    if (mark > 0) {
                        totalMarks += mark;
                        count++;
                    }
                }
            });
            
            if (count === 0) {
                document.getElementById('autoGrade').innerText = '-';
                document.getElementById('autoGPA').innerText = '-';
                document.getElementById('autoStatus').innerText = '-';
                return;
            }
            
            const average = Math.round(totalMarks / count);
            const gradeInfo = calculateGrade(average);
            
            document.getElementById('autoGrade').innerText = gradeInfo.grade;
            document.getElementById('autoGPA').innerText = gradeInfo.gpa.toFixed(2);
            document.getElementById('autoStatus').innerText = gradeInfo.status;
        }

        async function loadResultsManagement() {
            const select = document.getElementById('studentSelect');
            const table = document.getElementById('resultsListTable');
            select.innerHTML = '<option value="">নির্বাচন করুন</option>';
            table.innerHTML = '';
            
            studentsData.forEach(s => {
                select.innerHTML += `<option value="${s.docId}" data-studentid="${s.studentId}">${s.studentName} (${s.studentId})</option>`;
                
                const results = s.results || {};
                const resultComment = s.resultComment || "";
                
                // Calculate total marks and grade
                let totalMarks = 0;
                let count = 0;
                
                // Use current subjectsList for calculation
                subjectsList.forEach(subject => {
                    const mark = results[subject] || 0;
                    if (!isNaN(parseInt(mark))) {
                        totalMarks += parseInt(mark);
                        count++;
                    }
                });
                
                const average = count > 0 ? Math.round(totalMarks / count) : 0;
                const gradeInfo = calculateGrade(average);
                
                table.innerHTML += `
                    <tr>
                        <td>${s.studentId}</td>
                        <td>${s.studentName}</td>
                        <td><span class="grade-badge ${gradeInfo.class}">${gradeInfo.grade}</span></td>
                        <td><strong>${gradeInfo.gpa.toFixed(2)}</strong></td>
                        <td>${gradeInfo.status}</td>
                        <td>
                            <button class="action-btn btn-edit" onclick="editResults('${s.docId}')"><i class="fas fa-edit"></i></button>
                            <button class="action-btn btn-view" onclick="viewResults('${s.docId}')"><i class="fas fa-eye"></i></button>
                        </td>
                    </tr>
                `;
            });
            
            // Update subject input fields
            updateSubjectInputs();
        }

        window.loadStudentResults = () => {
            const select = document.getElementById('studentSelect');
            const id = select.value;
            if (!id) return resetResultForm();
            
            const student = studentsData.find(s => s.docId === id);
            if (student) {
                document.getElementById('editStudentId').value = id;
                
                // লোড হওয়ার পর অবজেক্ট ইনপুট আপডেট করার জন্য
                setTimeout(() => {
                    // সাবজেক্ট মার্কগুলো লোড করার জন্য
                    if (student.results) {
                        subjectsList.forEach(subject => {
                            const markInput = document.getElementById(`mark_${subject}`);
                            const gradeSpan = document.getElementById(`grade_${subject}`);
                            if (markInput && student.results[subject] !== undefined) {
                                const mark = student.results[subject];
                                markInput.value = mark;
                                
                                // Calculate and display grade
                                const numMark = parseInt(mark) || 0;
                                const gradeInfo = getSubjectGrade(numMark);
                                
                                if (gradeSpan) {
                                    gradeSpan.innerHTML = `<span class="grade-badge ${gradeInfo.class}">${gradeInfo.grade} (${gradeInfo.gpa})</span>`;
                                }
                            }
                        });
                    }
                    
                    // Calculate overall grade
                    calculateOverallGrade();
                    
                    // লোড মন্তব্য
                    document.getElementById('resultComment').value = student.resultComment || "";
                }, 100);
            }
        }

        window.editResults = (id) => {
            document.getElementById('studentSelect').value = id;
            loadStudentResults();
        }

        window.viewResults = (id) => {
            const student = studentsData.find(s => s.docId === id);
            if (student) {
                let resultText = `স্টুডেন্ট: ${student.studentName}\nআইডি: ${student.studentId}\n\nরেজাল্ট:\n`;
                
                const results = student.results || {};
                let total = 0;
                let count = 0;
                
                const subjectList = student.subjectList || subjectsList;
                subjectList.forEach(subject => {
                    const mark = results[subject] || 0;
                    const gradeInfo = getSubjectGrade(parseInt(mark) || 0);
                    resultText += `${subject}: ${mark} (${gradeInfo.grade}, GPA: ${gradeInfo.gpa})\n`;
                    if (!isNaN(parseInt(mark))) {
                        total += parseInt(mark);
                        count++;
                    }
                });
                
                const average = count > 0 ? Math.round(total / count) : 0;
                const finalGrade = calculateGrade(average);
                resultText += `\nগড় মার্ক: ${average}\nফাইনাল গ্রেড: ${finalGrade.grade}\nGPA: ${finalGrade.gpa.toFixed(2)}\nস্ট্যাটাস: ${finalGrade.status}\nমন্তব্য: ${student.resultComment || "N/A"}`;
                
                alert(resultText);
            }
        }

        window.saveResults = async () => {
            const studentId = document.getElementById('editStudentId').value;
            if (!studentId) return alert("স্টুডেন্ট সিলেক্ট করুন");
            
            const results = {};
            subjectsList.forEach(subject => {
                const markInput = document.getElementById(`mark_${subject}`);
                const mark = markInput ? markInput.value : '';
                if (mark !== '' && !isNaN(mark)) {
                    results[subject] = parseInt(mark);
                }
            });
            
            // Calculate overall grade automatically
            let totalMarks = 0;
            let count = 0;
            subjectsList.forEach(subject => {
                const mark = results[subject] || 0;
                if (mark > 0) {
                    totalMarks += mark;
                    count++;
                }
            });
            
            const average = count > 0 ? Math.round(totalMarks / count) : 0;
            const gradeInfo = calculateGrade(average);
            
            const resultComment = document.getElementById('resultComment').value;
            
            showLoader();
            try {
                await updateDoc(doc(db, "students", studentId), { 
                    results,
                    resultStatus: `${gradeInfo.grade} - ${gradeInfo.status}`,
                    resultComment,
                    subjectList: subjectsList, // Save current subject list with student
                    finalGrade: gradeInfo.grade,
                    finalGPA: gradeInfo.gpa,
                    resultsUpdatedAt: new Date()
                });
                
                alert("রেজাল্ট সফলভাবে সেভ হয়েছে!");
                resetResultForm();
                loadDashboardData(); // Refresh data
            } catch (error) {
                alert("রেজাল্ট সেভ করতে সমস্যা: " + error.message);
            } finally {
                hideLoader();
            }
        }

        window.resetResultForm = () => {
            document.getElementById('editStudentId').value = "";
            document.getElementById('studentSelect').value = "";
            document.getElementById('resultComment').value = "";
            
            // Clear all subject inputs
            subjectsList.forEach(subject => {
                const markInput = document.getElementById(`mark_${subject}`);
                const gradeSpan = document.getElementById(`grade_${subject}`);
                if (markInput) markInput.value = "";
                if (gradeSpan) gradeSpan.innerHTML = "-";
            });
            
            // Reset auto grade display
            document.getElementById('autoGrade').innerText = '-';
            document.getElementById('autoGPA').innerText = '-';
            document.getElementById('autoStatus').innerText = '-';
        }

        window.filterResults = () => {
            const input = document.getElementById('searchResult').value.toLowerCase();
            const table = document.getElementById('resultsListTable');
            const tr = table.getElementsByTagName('tr');
            for (let i = 0; i < tr.length; i++) {
                const tdName = tr[i].getElementsByTagName('td')[1];
                const tdId = tr[i].getElementsByTagName('td')[0];
                if (tdName || tdId) {
                    const txtValueName = tdName.textContent || tdName.innerText;
                    const txtValueId = tdId.textContent || tdId.innerText;
                    if (txtValueName.toLowerCase().indexOf(input) > -1 || txtValueId.toLowerCase().indexOf(input) > -1) {
                        tr[i].style.display = "";
                    } else {
                        tr[i].style.display = "none";
                    }
                }
            }
        }
        // ------------------------------------

        // --- রিপোর্ট ফাংশন ---
        window.downloadExcel = () => {
            const wb = XLSX.utils.book_new();
            // Convert data for excel
            const excelData = studentsData.map(s => ({
                "ID": s.studentId,
                "Name": s.studentName,
                "Mobile": s.studentMobile,
                "Course": s.courseName,
                "Fee": s.courseFee,
                "Status": s.status,
                "Address": s.address,
                "TrxID": s.trxId || "",
                "Final Grade": s.finalGrade || "N/A",
                "GPA": s.finalGPA || "N/A",
                "Result Comment": s.resultComment || ""
            }));
            const ws = XLSX.utils.json_to_sheet(excelData);
            XLSX.utils.book_append_sheet(wb, ws, "Students");
            XLSX.writeFile(wb, "Growth_Students_Report.xlsx");
        }

        window.printReport = () => {
            const content = document.getElementById('printableArea').innerHTML;
            const originalContents = document.body.innerHTML;
            document.body.innerHTML = content;
            document.getElementById('printHeader').style.display = 'block';
            window.print();
            document.body.innerHTML = originalContents;
            window.location.reload();
        }
        // ------------------------

        window.updateStudentStatus = async (docId, status) => {
            if(!confirm("আপনি কি নিশ্চিত এই ছাত্রের স্ট্যাটাস পরিবর্তন করতে চান?")) return;
            showLoader();
            try {
                const docRef = doc(db, "students", docId);
                const docSnap = await getDoc(docRef);
                const student = docSnap.exists() ? docSnap.data() : null;

                await updateDoc(docRef, { status: status });
                
                if(status === 'Approved' && student && student.email) {
                    try {
                        const emailParams = {
                            to_email: student.email,
                            to_name: student.studentName,
                            message: "অভিনন্দন! আপনার ভর্তি সফলভাবে সম্পন্ন হয়েছে। এখন আপনি স্টুডেন্ট প্যানেলে লগইন করতে পারবেন।"
                        };
                        await emailjs.send("service_180tb9o", "template_orbsx6o", emailParams);
                        alert("সফলভাবে আপডেট করা হয়েছে এবং মেইল পাঠানো হয়েছে!");
                    } catch(e) {
                        alert("আপডেট হয়েছে, কিন্তু মেইল পাঠানো যায়নি।");
                    }
                } else {
                    alert("সফলভাবে আপডেট করা হয়েছে!");
                }
                loadDashboardData(); 
            } catch (error) {
                alert("Error: " + error.message);
                hideLoader();
            }
        };

        window.deleteStudent = async (docId) => {
            if(!confirm("সতর্কতা: এটি স্থায়ীভাবে মুছে যাবে! ডাটাবেজ থেকে সকল তথ্য ডিলিট হবে। আপনি কি নিশ্চিত?")) return;
            showLoader();
            try { 
                await deleteDoc(doc(db, "students", docId)); 
                alert("শিক্ষার্থীর সকল তথ্য ডাটাবেজ থেকে মুছে ফেলা হয়েছে!"); 
                loadDashboardData(); 
            } catch (error) { alert("Error: " + error.message); hideLoader(); }
        };

        window.filterStudents = () => {
            const input = document.getElementById('searchInput').value.toLowerCase();
            const table = document.getElementById('allStudentsTable');
            const tr = table.getElementsByTagName('tr');
            for (let i = 0; i < tr.length; i++) {
                const tdName = tr[i].getElementsByTagName('td')[1];
                const tdId = tr[i].getElementsByTagName('td')[0];
                if (tdName || tdId) {
                    const txtValueName = tdName.textContent || tdName.innerText;
                    const txtValueId = tdId.textContent || tdId.innerText;
                    if (txtValueName.toLowerCase().indexOf(input) > -1 || txtValueId.toLowerCase().indexOf(input) > -1) {
                        tr[i].style.display = "";
                    } else {
                        tr[i].style.display = "none";
                    }
                }
            }
        };

        async function loadSettings() {
            try {
                const docSnap = await getDoc(doc(db, "settings", "siteConfig"));
                if(docSnap.exists()) {
                    const data = docSnap.data();
                    document.getElementById('siteNotice').value = data.notice || "";
                    document.getElementById('siteOffer').value = data.offer || "";
                }
            } catch (e) { console.log("No settings found, creating new."); }
        }

        window.saveSiteSettings = async () => {
            const notice = document.getElementById('siteNotice').value;
            const offer = document.getElementById('siteOffer').value;
            showLoader();
            try { await setDoc(doc(db, "settings", "siteConfig"), { notice: notice, offer: offer, updatedAt: new Date() }); alert("সেটিংস সেভ হয়েছে! ইউজার অ্যাপে পরিবর্তন দেখা যাবে।"); } catch (error) { alert("Error: " + error.message); } finally { hideLoader(); }
        };

        window.switchView = (viewId) => {
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.menu li a').forEach(el => el.classList.remove('active'));
            document.getElementById(viewId).classList.add('active');
            document.querySelector(`a[onclick="switchView('${viewId}')"]`).classList.add('active');
        };
        function showLoader() { document.getElementById('loader').style.display = 'flex'; }
        function hideLoader() { document.getElementById('loader').style.display = 'none'; }
    </script>
</body>
</html>